---
sidebar_position: 3
sidebar_label: '自定义关系'
---
A表在表上添加引用字段指向B表，创建 JET 可以理解的关系。这允许您在B表中的记录上添加一个关联列表，它显示了链接到它的A表中的记录。

<!-- 从sys_m2m关系定义表创建 M2M 表也会创建 JET 可以理解的关系。因此，您可以在由关系链接的两个表中的任何一个上添加关联列表，以显示另一个表中的相关记录。 -->

但是，如果您想定义更复杂的关系，JET 也允许您这样做！让我们探讨一个生成票证定义的自定义关系的示例。

服务目录请求具有一种任务层次结构。请求[sc_request] 是多个请求项 [sc_req_item]（通常称为RITM ）之一的父项，它可能是一个或多个目录任务 [sc_task] 的父项，不要与系统任务表[Task]表混淆。工作通常记录在这个关系层次结构的底部，即目录任务 [sc_task]记录中，但是请求所针对的人存储在请求 [sc_request]表中名为请求 [request_for]的字段中。

#### 定义自定义关系
  

当我说父母时，我指的是父母的亲子关系;它们实际上并不使用父母 [Parent]字段来处理这种关系。
  
![自定义关系1](/img/data-relationship/custom-relationshop.jpeg)  
<center>请求/请求项/目录任务关系层次结构的可视化表示</center>    
<br/>

因此，如果您希望能够在**用户**表中该用户记录的关联列表中看到与给定用户请求相关的目录任务，那么 JET 没有你可利用的任何内置关系。因此，您需要通过以下步骤定义自定义关系:

1. 在应用程序导航器中，导航到系统定义|关联列表关系。这是一个表，包含连接任意两组记录的已定义关系。在右上角，单击新增。

2. 给这种关系起一个你熟悉的名字。由于这将是用户之间的关系，以及为这些用户请求的请求下的目录任务，我将其称为用户请求的任务。

3. **应用于表**字段是您选择显示关联列表记录的表的地方。对于我们的用例，在这个字段中选择用户 [sys_user]表。带有脚本的查询中的父对象对应该表中的记录。

4. **查询来源表**字段用于显示关联列表中的表。因为我们的关联列表将包含目录任务，所将这个字段设置为目录任务[s_task]表。使用脚本查询的对象对应该表中的记录。

5. 表单的其余部分填好后，我们需要定义用于查询的脚本。我们将在后面的章节中更详细地介绍GlideRecord查询脚本，但现在只是复制如下所示的代码，然后我们将检查它在做什么。  

在refineQuery(current, parent{})块中编写以下代码:
```
    var parentSid = parent.getValue('sys_id'); 
    current.addQuery('request.requested_for', parentSid); 
```   

在第一行(在编辑器中，这将是第2行或第3行)，我们创建了一个名为parentSid的变量(它代表父系统ID)，它将包含父记录的sys_id列的值。父对象对应于将显示关联列表的sys_user表中的记录，因此描述parentSid的另一种方式是，它包含当前打开的记录的Sys ID，关联列表将在该记录上显示。  

在第二行，我们使用GlideRecord类的一个方法addQuery()。这个方法将在后面的章节中详细解释，但是现在，只需要理解我们在相关列表中显示的表上添加了一个查询过滤器。通过传递两个参数，我们告诉它第一个参数(一个字段名)应该等于第二个参数的值(我们在上一行获得的父参数的sys_ID)。在第一个论证中，您可能已经注意到我们还使用了在前一章中学习过的点遍历。  

这个查询有效地说明:确保请求引用字段中的记录上的**请求**字段的值等于显示相关列表的记录的sys_id。  

现在点击提交。最终的形式应该看起来像这样:
![自定义关系1](/img/data-relationship/custom-relationship2.jpg)   

<!-- **未实现功能** -->

<!-- 现在我们需要进行测试，以确保关联列表按照我们的预期工作。为此，我们需要生成一些目录任务。在应用程序导航器中，转到个人服务 |任务，单击新增，并选择目录任务。填写申请表格，然后点击提交。然后，再次重复该过程，因此您将有两个单独的请求，每个请求有一个项，以及一个目录任务。  

接下来，使用.list快捷方式导航到sc_task表，找到刚才创建的两个任务。通过点击任务编号打开其中一个。在右侧，您应该看到一个请求字段。这个字段应该包含您的用户帐户(系统管理员是默认名称)。将该字段的值更改为其他用户，如Abel Tuter，并保存记录。    -->
<!-- 
提示
Requested for字段实际上不在sc_task表格上；这是一个derived领域。这意味着它实际上存在于另一个表上，通过表上的一个参考字段链接sc_task。要查看该关系，请右键单击标签Requested for，然后单击Show - 'requested_for'。将出现一个小对话框，您将在顶行看到字典信息。那应该显示字段名称，但字段名称是点走的：sc_task.request_item.request.requested_for。这意味着这个领域实际上是点走两层深。

现在，通过单击屏幕右上角的姓名并选择Profile导航到您自己的用户个人资料。（请注意，使用此链接访问您的个人资料会自动将您定向到自助服务视图）：

定义自定义关系
在您的个人资料页面上，右键单击标题，然后转到配置| 相关列表。在下一页，选择左侧的Tasks Requested for User，单击向右箭头将其移动到右侧的存储桶中。如果您想将此相关列表显示在自助服务以外的视图上视图，您可以更改视图名称字段。单击保存。

提示
当您在下拉列表或slush-bucket字段中有大量项目时，您通常可以通过选择一个值来找到您要查找的项目，然后快速输入您要查找的值的名称. 例如，如果您要查找Tasks Requested for User之类的值，请在列表中选择任意随机值，然后键入tasks requested，它通常会将您带到那里。

您现在应该看到在请求派生字段中具有系统管理员的目录任务，但看不到您将请求字段更改为的目录任务。让我们也检查一下 Abel Tuter 的个人资料，以确保那里的相关列表显示.Abel TuterCatalog Task

再次使用应用程序导航器过滤器文本框中的快捷方式导航到sys_user表.list，然后找到并单击 Abel Tuter 的用户配置文件。您可能仍处于自助服务视图中，因此您的相关列表仍应显示。如果是这样，您应该会看到您设置为请求的任务Abel Tuter。如果没有，请右键单击顶部，然后转到查看| 自助服务。 -->

